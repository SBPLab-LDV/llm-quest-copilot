**極簡規劃：口語表達「嗆到，想回家。」關鍵詞對齊**

更新日期：2025-10-15
狀態：規劃紀錄（未套用；供審閱與版本追蹤）

—

目的
- 以最低成本（Prompt-first、無新欄位、無後處理檢核）讓 options 直接對齊 original 的兩個關鍵短語：「嗆到」與「想回家」。
- 避免無關泛用句（如「調整枕頭」「請護理師過來看看」）占據槽位，導致意圖偏離。

原則
- 僅微調提示文本（模板與規則字串），不改 JSON 形狀，不新增自定義程式邏輯。
- 保持先前「限制一致性、口語化、完整句」等規則不變。

—

具體改動（擬定文案）
1) 模板補充（加入於【重要原則】末尾）
- 檔案：`prompts/templates/audio_disfluency_template.yaml`
- 文案：
  - 「若 original 含多個短語（以逗號/頓號分隔），請將每個短語視為關鍵意圖；前兩句請優先各自直接提及對應的關鍵詞或等價詞。」
  - 「嗆到等價詞示例：嗆 / 嗆咳 / 誤嚥 / 吞嚥困難；回家等價詞示例：回家 / 出院 / 返家 / 出院評估。」
  - 「不得以與關鍵詞無關的泛用請求（如『調整枕頭』『請護理師過來看看』）取代對關鍵詞的直接回應；若使用此類句子，必須同句同時回應關鍵詞。」

2) 規則字串補充（音訊規則提醒最後一行）
- 檔案：`src/core/audio/context_utils.py:58`（`build_audio_template_rules`）
- 文案：
  - 「若 original 含多個短語（逗號/頓號分隔），請將每個短語視為關鍵意圖，前兩句須分別直接提及對應關鍵詞或等價詞；不得以與關鍵詞無關的泛用請求取代。」

3)（選配）降低多模態生成溫度
- 檔案：`src/llm/gemini_client.py:260`（音訊 `generation_config`）
- 內容：`"temperature": 0.4 → 0.3`（輕微收斂發散，降低無關泛用句機率）

—

前/後差異（以「嗆到，想回家。」為例）
- Before（觀測於日誌）
  - original: 「嗆到，想回家。」
  - options: 拍背/護理師/聯絡家人/調枕頭（僅 1 句涉及「嗆到」，「想回家」被解讀為思鄉）。
- After（期望）
  - original: 「嗆到，想回家。」
  - options：
    - 「我吃東西容易嗆到，能教我怎麼避免誤嚥嗎？」（對齊：嗆到/誤嚥）
    - 「我想回家休養，可以請醫師評估出院安排嗎？」（對齊：回家/出院）
    - 「嗆咳時會不舒服，能否示範正確的吞嚥姿勢？」（延伸：嗆咳/吞嚥）
    - 「如果現在不適合出院，請告訴我需要注意什麼才能準備返家。」（延伸：回家/出院評估）

—

思考推理鏈（為什麼這樣設計）
- 先前規則偏向「完整句＋多樣性＋限制遵循」，但缺少極簡的「句級關鍵詞對齊」。
- 在不增加複雜判斷的前提下，用「前兩句必須直對齊 original 的兩個短語」這一條，將模型注意力拉回關鍵意圖。
- 提供等價詞列表，避免模型為了找同義而展開複雜推理；同時禁止「無關泛用句取代關鍵回應」，抑制模板化偏移。

—

測試與驗證
- 用例：
  - 「嗆..到..回...家」與「嗆到，想回家。」各執行 ≥3 次。
- 驗證點：
  - 前兩句是否各自直接提及「嗆到（或等價）」與「回家（或等價）」？
  - 是否避免以「調枕頭 / 護理師過來看看」取代對關鍵詞的回應？
  - 保持口語化、單句、限制一致性（不可違反吞嚥/口進食等限制）。

—

風險與回滾
- 改動僅為提示文本與（選配）溫度微調；若效果不佳，可直接還原文案與參數。
- 若仍出現「想家（情緒）」偏義，可在模板【正確範例】增補一個「回家=出院」的對照示例以強化錨定（不改動程式碼）。

